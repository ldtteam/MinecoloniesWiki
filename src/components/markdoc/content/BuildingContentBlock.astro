---
import { createMarkdownProcessor } from '@astrojs/markdown-remark';
import ContentBlock from '@components/markdoc/content/ContentBlock.astro';
import { getBuildingData } from '@utils/building';
import { loadDynamicImage } from '@utils/util';

import type { BaseContentBlockProps } from './types';

interface Props extends BaseContentBlockProps {
  header?: string;
  imageKey: string;
  imageAlt: string;
  markdownContent?: string;
}

const TAB_INDEXES = ['first', 'second', 'third', 'fourth', 'fifth', 'sixth', 'seventh', 'eight', 'ninth', 'tenth'];

const { name, order = 1, cols, header, imageKey, imageAlt, markdownContent } = Astro.props;

const buildingData = await getBuildingData(name);

const importedImage = await loadDynamicImage(
  `../../../assets/images/wiki/gui/buildings/${buildingData.id}/${imageKey}.png`
);

const processor = await createMarkdownProcessor();
const headerContent = header
  ? await processor.render(`The ${TAB_INDEXES[order - 1]} tab of the GUI is the **${header}**.`)
  : undefined;
const content = markdownContent ? await processor.render(markdownContent) : undefined;
---

<ContentBlock image={importedImage} imageAlt={`${imageAlt} tab of the ${buildingData.data.name} it's GUI`} cols={cols}>
  {headerContent && <Fragment set:html={headerContent.code} />}
  <slot name="before-content" />
  {content && <Fragment set:html={content.code} />}
  <slot />
</ContentBlock>
